# https://taskfile.dev

version: 3

tasks:
  build-git:
    desc: "Build from source."
    env:
      GNOCI_BUILD_PATH: bin/git-remote-oci
    cmds:
      - dagger call build-git --src=. export --path {{ .GNOCI_GIT_BUILD_PATH }}

  build-git-lfs:
    desc: "Build from source."
    env:
      GNOCI_BUILD_PATH: bin/git-lfs-remote-oci
    cmds:
      - dagger call build-git-lfs --src=. export --path {{ .GNOCI_GIT_LFS_BUILD_PATH }}

  go-generate:
    desc: "Run go generate."
    sources:
      - "*.go"
      - "**/*.go"
    cmds:
      - go generate ./...

  release:
    desc: "Run release process."
    cmds:
      - ./release.sh -i

  lint-go:
    desc: "Lint go files"
    cmds:
      - dagger call lint go

  lint-govuln:
    desc: "Run govulncheck"
    cmds:
      - dagger call lint vulncheck

  lint-shell:
    desc: "Lint shell scripts"
    cmds:
      - dagger call lint shell

  lint-yaml:
    desc: "Lint yaml files"
    cmds:
      - dagger call lint yaml

  lint-markdown:
    desc: "Lint markdown files"
    cmds:
      - dagger call lint markdown

  lint:
    desc: "Run all linters"
    cmds:
      - dagger call lint all
